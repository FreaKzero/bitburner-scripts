import {
  $,
  goCity,
  goTravel,
  inView,
  reactClickButton,
  reactSetInput,
} from "../lib/ui";
import { line, setupTail } from "../lib/utils";

/** @param {import("..").NS } ns */
export async function main(ns) {
  window._floorOriginal = Math.floor;
  window._randomOriginal = Math.random;

   Math.floor = () => {
      return 1;
    };

    Math.random = () => {
      return 0;
    };

  ns.disableLog("ALL");
  const ln = line(46, "white");

  setupTail(ns, {
    title: "ðŸŽ¡ Roulette Exploit",
    w: 446,
    h: 247,
    x: 643,
    y: 3,
  });

  ns.atExit(() => {
    Math.floor = window._floorOriginal;
    Math.random = window._randomOriginal;
  });

  goTravel("Aevum");
  goCity("casino");

  reactClickButton("Play roulette");
  await ns.sleep(1500);

  const $button1 = $('button').find(
          b => b.innerText.trim() === "1");

  while (true) {
    reactSetInput("Amount to play", ns.getPlayer().money);

    if (
       $(`span.MuiTypography-root`).find((a) =>
        a.innerText.includes("cheater")
      )
    ) {
      ns.print(ln);
      ns.print("You got thrown out");
      ns.exit();
    }

    if (!inView("casino")) {
      goCity("casino");
    } else {
      const trigger =  $(`.MuiBox-root h4`)[2].innerText;
      
      if (trigger !== "playing") {
        reactClickButton($button1);
      }
    }

    await ns.sleep(1500);
  }
}
