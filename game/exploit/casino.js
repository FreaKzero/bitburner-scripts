import { goCity, goTravel, inView, reactClickButton, reactSetInput } from "../lib/ui";
import { line, setupTail } from "../lib/utils";

const toggleMath = (fake) => {
  if (fake) {
    // eslint-disable-next-line @typescript-eslint/no-unused-vars
    Math.floor = (number) => {
      return 1;
    };

    Math.random = () => {
      return 0;
    };
  } else {
    Math.floor = window._floorOriginal;
    Math.random = window.randomOriginal;
  }
};

/** @param {import("..").NS } ns */
export async function main(ns) {
  window._floorOriginal = Math.floor;
  window._randomOriginal = Math.random;

  ns.disableLog("ALL");
  const ln = line(46, "white");

  setupTail(ns, {
    title: "ðŸŽ¡ Roulette Exploit",
    w: 446,
    h: 247,
    x: 643,
    y: 3,
  });

  goTravel("Aevum");
  goCity("casino");

  toggleMath(1);

  reactClickButton("Play roulette");
  await ns.sleep(1000);
  reactSetInput("Amount to play", 99999999);

  ns.atExit(() => {
    toggleMath();
  });
  let i = 0;
  while (true) {
   
    if (i === 0) {
      reactSetInput(99999999);
      toggleMath(1);
    }

    if (i === 5) {
      reactSetInput(1);
      toggleMath();
      i = 0;
    }

    if (
      [...document.querySelectorAll("span.MuiTypography-root")].find((a) =>
        a.innerText.includes("cheater")
      )
    ) {
      ns.print(ln);
      ns.print("You got thrown out");
      ns.exit();
    }

    if (!inView('casino')) {
      goCity("casino");
    } else {
      const trigger = document.querySelectorAll(".MuiBox-root h4")[2].innerText;

      if (trigger !== "playing") {
        reactClickButton("1");
        i++;
      }
    }

    await ns.sleep(1500);
  }
}
