import {
  $,
  goCity,
  goTravel,
  inView,
  reactClickButton,
  reactSetInput,
} from "../lib/ui";
import { line, setupTail } from "../lib/utils";

const toggleMath = (fake) => {
  if (fake) {
    // eslint-disable-next-line @typescript-eslint/no-unused-vars
    Math.floor = (number) => {
      return 1;
    };

    Math.random = () => {
      return 0;
    };
  } else {
    Math.floor = window._floorOriginal;
    Math.random = window._randomOriginal;
  }
};

/** @param {import("..").NS } ns */
export async function main(ns) {
  window._floorOriginal = Math.floor;
  window._randomOriginal = Math.random;

  ns.disableLog("ALL");
  const ln = line(46, "white");

  setupTail(ns, {
    title: "ðŸŽ¡ Roulette Exploit",
    w: 446,
    h: 247,
    x: 643,
    y: 3,
  });

  ns.atExit(() => {
    toggleMath(null);
  });

  goTravel("Aevum");
  goCity("casino");

  toggleMath(1);
  reactClickButton("Play roulette");

  while (true) {
    reactSetInput("Amount to play", ns.getPlayer().money);

    if (
       $(`span.MuiTypography-root`).find((a) =>
        a.innerText.includes("cheater")
      )
    ) {
      ns.print(ln);
      ns.print("You got thrown out");
      ns.exit();
    }

    if (!inView("casino")) {
      goCity("casino");
    } else {
      const trigger =  $(`.MuiBox-root h4`)[2].innerText;
      
      if (trigger !== "playing") {
        reactClickButton("1");
      }
    }

    await ns.sleep(1500);
  }
}
